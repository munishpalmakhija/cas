inputs:
  TargetCloudType:
    title: Target Cloud Type
    type: string
    default: OnPrem-vSphere
    enum:
      - AWS
      - OnPrem-vSphere
      - VMWonAWS
resources:
  AnsibleControlMachine:
    type: Cloud.Machine
    metadata:
      layoutPosition:
        - 0
        - 0
    properties:
      image: ubuntu
      flavor: small
      constraints:
        - tag: '${input.TargetCloudType}'
      cloudConfig: |
        #cloud-config
        chpasswd:
          list: |
            root:VMware1!
          expire: False  
        runcmd:
        - sed -e 's/.*127.*/127.0.0.1 ansiblecontrolmachine/' -i /etc/hosts
        - sudo sed -e 's/.*PasswordAuthentication no.*/PasswordAuthentication yes/' -i /etc/ssh/sshd_config
        - sudo sed -i -e '/^PermitRootLogin/s/^.*$/PermitRootLogin yes/' /etc/ssh/sshd_config
        - sudo service sshd restart
        - apt-add-repository ppa:ansible/ansible --yes
        - apt-get update
        - apt-get install ansible --yes
        - sudo sed -e 's/.*host_key_checking = False.*/host_key_checking = False/' -i /etc/ansible/ansible.cfg
        - sudo chmod 777 /etc/ansible/
        - sudo chmod 777 /etc/ansible/hosts
        - sudo sed -e 's/.*vault_password_file.*/vault_password_file=vault_pass.txt/' -i /etc/ansible/ansible.cfg
        - sudo touch /etc/ansible/vault_pass.txt
        - sudo echo â€˜VMware1! > /etc/ansible/vault_pass.txt
